<!DOCTYPE html>
<html>
<head>
<title>Poker Hands VR</title>
<script src="https://aframe.io/releases/0.3.1/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/v1.3.1/dist/aframe-altspace-component.min.js"></script>
<script src="https://sdk.altvr.com/libs/altspace.js/0.28.1/altspace.min.js"></script>
<script src="https://unpkg.com/aframe-text-component@^0.4.1/dist/aframe-text-component.min.js"></script>
<script src="https://rawgit.com/mayognaise/aframe-html-shader/master/dist/aframe-html-shader.min.js"></script>
</head>
<body>
    <a-scene altspace="verticalAlign: bottom">
      
      
      
      <a-entity id='deck' position='0.3 0.91 0.7' position='0 1.5 0'>
        <a-cylinder color="white" height="0.02" radius="0.007" position='-0.053 0 -0.078'></a-cylinder>
        <a-cylinder color="white" height="0.02" radius="0.007" position='0.053 0 -0.078'></a-cylinder>
        <a-cylinder color="white" height="0.02" radius="0.007" position='-0.053 0 0.078'></a-cylinder>
        <a-cylinder color="white" height="0.02" radius="0.007" position='0.053 0 0.078'></a-cylinder>
        <a-box color='white' scale='0.12 0.02 0.16' position='0 0 0'></a-box>
        <a-box color='white' scale='0.11 0.02 0.17' position='0 0 0'></a-box>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/back.png' position='0 0.0101 0' rotation='270 0 0' width='.12' height='0.17' transparent='true'></a-plane>
      </a-entity>
      
      <a-cylinder color="white" height="0.005" radius="0.03" position='0 0.905 0.3'>
        <a-animation attribute='position' to='0.3 0.905 0.9' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="red" height="0.005" radius="0.03" position='0 0.91 0.3'>
        <a-animation attribute='position' to='-0.42426406871192851464050661726291 0.905 0.84852813742385702928101323452581' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="blue" height="0.005" radius="0.03" position='0 0.915 0.3'>
        <a-animation attribute='position' to='-0.9 0.905 0.3' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="green" height="0.005" radius="0.03" position='0 0.92 0.3'>
        <a-animation attribute='position' to='-0.84852813742385702928101323452581 0.905 -0.42426406871192851464050661726291' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="white" height="0.005" radius="0.03" position='0 0.925 0.3'>
        <a-animation attribute='position' to='-0.3 0.905 -0.9' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="red" height="0.005" radius="0.03" position='0 0.93 0.3'>
        <a-animation attribute='position' to='0.42426406871192851464050661726291 0.905 -0.84852813742385702928101323452581' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="blue" height="0.005" radius="0.03" position='0 0.935 0.3'>
        <a-animation attribute='position' to='0.9 0.905 -0.3' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      <a-cylinder color="green" height="0.005" radius="0.03" position='0 0.94 0.3'>
        <a-animation attribute='position' to='0.84852813742385702928101323452581 0.905 0.42426406871192851464050661726291' delay='2000' repeat='indefinite' direction='alternate'/>
      </a-cylinder>
      
        <a-entity id='row1' position='0 1.1 -2.5'></a-entity>
        <a-entity id='row2' position='0 0.9 -2.5'></a-entity>
        <a-entity id='row3' position='0 1.8 -2.5'></a-entity>
        
        <a-box id="randomHand" position='-0.5 0.6 -2.5' width='0.8' height='0.25' depth='0.01' color='#000000'></a-box>
        <a-entity n-text="fontSize:1; width:4; text:Random" position="-0.5 0.6 -2.49"></a-entity>
        <a-box id="clear" position='0.5 0.6 -2.5' width='0.8' height='0.25' depth='0.01' color='#000000'></a-box>
        <a-entity n-text="fontSize:1; width:4; text:Clear" position="0.5 0.6 -2.49"></a-entity>
        
      <a-entity>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/S14.png' position='0 2.3 0' width='.72' height='1.02' transparent='true'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/back.png' position='0 2.3 0' width='.72' height='1.02' rotation='0 180 0' transparent='true'></a-plane>
        <a-animation to='0 360 0' easing='linear' dur='15000' repeat='indefinite'/>
        </a-entity>
      
      
      <a-entity id='tableSurface' position='0 0.901 0' rotation='-90 0 0'>
        <a-entity n-text="fontSize:1; width:4; text:" position="-0.6 0.4 0" rotation='0 0 -90'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="-0.6 -0.4 0" rotation='0 0 -90'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="0.6 0.4 0" rotation='0 0 90'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="0.6 -0.4 0" rotation='0 0 90'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="0.4 -0.6 0" rotation='0 0 0'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="-0.4 -0.6 0" rotation='0 0 0'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="0.4 0.6 0" rotation='0 0 180'></a-entity>
        <a-entity n-text="fontSize:1; width:4; text:" position="-0.4 0.6 0" rotation='0 0 180'></a-entity>
        
        
        <a-entity id='gridLines' position='10 0 -0.1'>
          <a-plane position='0 -0.6 0' width='2.5' height='0.01' rotation='0 0 0' color='#FFFFFF'></a-plane>
          <a-plane position='0 0.6 0' width='2.5' height='0.01' rotation='0 0 0' color='#FFFFFF'></a-plane>
          <a-plane position='0 0 0' width='2.5' height='0.01' rotation='0 0 0' color='#FFFFFF'></a-plane>
          <a-plane position='0.6 0 0' width='0.01' height='2.5' rotation='0 0 0' color='#FFFFFF'></a-plane>
          <a-plane position='-0.6 0 0' width='0.01' height='2.5' rotation='0 0 0' color='#FFFFFF'></a-plane>
          <a-plane position='0 0 0' width='0.01' height='2.5' rotation='0 0 0' color='#FFFFFF'></a-plane>
      </a-entity>
        
      </a-entity>
        
        <a-entity id='text' n-text="fontSize:3; width:4; text:" position="0 2.5 -2.5"></a-entity>
        
      
        <a-cylinder position='0 0.875 0' radius='1.25' height='0.05' color='#1f6322'></a-cylinder>
        <a-torus position='0 0.875 0' rotation='90 0 0' radius='1.25' radius-tubular='0.03' segments-tubular='100' color='#281b08'></a-torus>
      <a-cylinder position='0 0.3 0' radius='0.15' height='1' depth='.3' color='#281b08'></a-cylinder>
        
      
        <a-entity rotation='-60 0 0' position='0 0.9 0'>  
          <a-box position='0 0 0' width='0.7' height='0.2' depth='0.12' color='#1f6322'></a-box>
          <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/OL.png' position='-0.27 0 0.061' width='.13' height='0.18' transparent='true' rotation='0 0 0' color='#FFFF00'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/OL.png' position='-0.135 0 0.061' width='.13' height='0.18' transparent='true' rotation='0 0 0' color='#FFFF00'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/OL.png' position='0 0 0.061' width='.13' height='0.18' transparent='true' rotation='0 0 0' color='#FFFF00'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/OL.png' position='0.135 0 0.061' width='.13' height='0.18' transparent='true' rotation='0 0 0' color='#FFFF00'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/OL.png' position='0.27 0 0.061' width='.13' height='0.18' transparent='true' rotation='0 0 0' color='#FFFF00'></a-plane>
          <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/S11.png' position='-0.27 0 0.062' width='.12' height='0.17' transparent='true'></a-plane>
        <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/S12.png' position='-0.135 0 0.062' width='.12' height='0.17' transparent='true'></a-plane>
      <a-plane src='https://bengarfield.github.io/AltVR-Tests/poker/S13.png' position='0 0 0.062' width='.12' height='0.17' transparent='true'></a-plane>
        </a-entity>
        <a-entity position='0 0 4'>
            <a-camera></a-camera>
        </a-entity>
    </a-scene>
<script>
  var config = {
    baseRefUrl: "https://cubesync-f70b7.firebaseio.com",
    authorId: "BenG",
    appId: "PokerTest1"
  };
  Promise.all([
    altspace.utilities.sync.connect(config)
  ]).then(function(results) {
    connection = results[0];
    var syncedCards = connection.instance.child('syncedCards');
    var cards = ["C14", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "D14", "D2", "D3", "D4", "D5", "D6", "D7", "D8", "D9", "D10", "D11", "D12", "D13", "H14", "H2", "H3", "H4", "H5", "H6", "H7", "H8", "H9", "H10", "H11", "H12", "H13", "S14", "S2", "S3", "S4", "S5", "S6", "S7", "S8", "S9", "S10", "S11", "S12", "S13"];
    
    var selectedCards = [];
    var allHands = [];
    
    var playerPotX = [0.9, 0.84852813742385702928101323452581, 0.3, -0.42426406871192851464050661726291, -0.9, -0.84852813742385702928101323452581, -0.3, 0.42426406871192851464050661726291];
    var playerPotY = [0.3, -0.42426406871192851464050661726291, -0.9, -0.84852813742385702928101323452581, -0.3, 0.42426406871192851464050661726291, 0.9, 0.84852813742385702928101323452581];
    
    syncedCards.on('value', function(data) {
      if (data.val() == null) {
        selectedCards = [];
      } else if (selectedCards != data.val()) {
        selectedCards = data.val();
        updateSelCards();
        syncedCards.set(selectedCards);
        if (selectedCards.length == 7) {
            findHands();
        } else {
          document.querySelector('#text').setAttribute('n-text', {fontSize:3, text:" "});
        }
        for (var i = 0; i < cards.length; i++) {
            document.querySelector('#' + cards[i]).setAttribute('color', '#FFFFFF');
        }
        for (var i = 0; i < cards.length; i++) {
            document.querySelector('#' + selectedCards[i]).setAttribute('color', '#555555');
        }
      }
    });
    
    for (var i = 0; i < 52; i++) {
        var box = document.createElement('a-plane');
        box.setAttribute('id', cards[i]);
        box.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + cards[i] + '.png');
        box.setAttribute('width', '0.12');
        box.setAttribute('height', '0.17');
        box.setAttribute('transparent', 'true');
        box.addEventListener('mousedown', function (event) { cardClick(event.target); });
        if (i < 26) {
            box.setAttribute('position', -1.875+(i*.15) + ' 0 0');
            //console.log(i + ': ' + (-1.875+(i*.15)) + ' 0 0');
            document.querySelector('#row1').appendChild(box);
        } else {
            box.setAttribute('position', -1.875+((i-26)*.15) + ' 0 0');
            document.querySelector('#row2').appendChild(box);
        }
    }
    for (var i = 1; i<8; i++) {
        var box = document.createElement('a-plane');
        box.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/blank.png');
        box.setAttribute('id', 'sel' + i);
        box.setAttribute('width', '0.48');
        box.setAttribute('height', '0.68');
        box.setAttribute('position', (i-4)*.6 + ' 0 0');
        box.setAttribute('transparent', 'true');
        document.querySelector('#row3').appendChild(box);
        box.addEventListener('mousedown', function (event) { selCardClick(event.target); });
        var outline = document.createElement('a-plane');
        outline.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/OL.png');
        outline.setAttribute('width', '0.52');
        outline.setAttribute('height', '0.72');
        outline.setAttribute('position', (i-4)*.6 + ' 0 -0.001');
        outline.setAttribute('transparent', 'true');
        if (i < 6) {
            outline.setAttribute('color', 'yellow');
        } else {
            outline.setAttribute('color', 'red');
        }
        document.querySelector('#row3').appendChild(outline);
    }
  
    document.querySelector('#randomHand').addEventListener('mousedown', function (event) { randomise(); });
    document.querySelector('#clear').addEventListener('mousedown', function (event) { clear(); });
    createTable();
    function createTable() {
        for (var i = 0; i < 8; i++) {
            var playerSpot = document.createElement('a-entity');
          
            // Center marker
            var marker = document.createElement('a-sphere');
            marker.setAttribute('scale', '.01 .01 .01');
            marker.setAttribute('position', '0 0 0');
            playerSpot.appendChild(marker);
          
            var outline = document.createElement('a-plane');
            outline.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/OL.png');
            outline.setAttribute('scale', '0.13 0.18 0');
            outline.setAttribute('transparent', 'true');
            outline.setAttribute('color', '#FFFF00');
            outline.setAttribute('position', '-0.07 .6 0');
            playerSpot.appendChild(outline);
            var outline2 = document.createElement('a-plane');
            outline2.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/OL.png');
            outline2.setAttribute('scale', '0.13 0.18 0');
            outline2.setAttribute('transparent', 'true');
            outline2.setAttribute('color', '#FFFF00');
            outline2.setAttribute('position', '0.07 0.6 0');
            playerSpot.appendChild(outline2);
            
            var cardHolder = document.createElement('a-entity');
            var card1Front = document.createElement('a-plane');
            var card1Back = document.createElement('a-plane');
            var card2Front = document.createElement('a-plane');
            var card2Back = document.createElement('a-plane');
            cardHolder.setAttribute('rotation', '70 0 0');
            card1Back.setAttribute('rotation', '180 0 0');
            card2Back.setAttribute('rotation', '180 0 0');
            cardHolder.setAttribute('position', '0 -0.92 0.2');
            card1Front.setAttribute('position', '-0.07 0 0');
            card1Back.setAttribute('position', '-0.07 0 0');
            card2Front.setAttribute('position', '0.07 0 0');
            card2Back.setAttribute('position', '0.07 0 0');
            card1Front.setAttribute('scale', '0.12 0.17 0');
            card1Back.setAttribute('scale', '0.12 0.17 0');
            card2Front.setAttribute('scale', '0.12 0.17 0');
            card2Back.setAttribute('scale', '0.12 0.17 0');
            card1Front.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/S14.png');
            card1Back.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/back.png');
            card2Front.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/S10.png');
            card2Back.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/back.png');
            card1Front.setAttribute('transparent', 'true');
            card1Back.setAttribute('transparent', 'true');
            card2Front.setAttribute('transparent', 'true');
            card2Back.setAttribute('transparent', 'true');
            
            var cardAnim = document.createElement('a-animation');
            var cardAnim2 = document.createElement('a-animation');
            cardAnim.setAttribute('to', '0 0 0');
            cardAnim.setAttribute('direction', 'alternate');
            cardAnim.setAttribute('repeat', 'indefinite');
            cardAnim2.setAttribute('attribute', 'position');
            cardAnim2.setAttribute('to', '0 -0.6 0.001');
            cardAnim2.setAttribute('direction', 'alternate');
            cardAnim2.setAttribute('repeat', 'indefinite');
            cardAnim.setAttribute('delay', '2000');
            cardAnim2.setAttribute('delay', '2000');
            
            cardHolder.appendChild(card1Front);
            cardHolder.appendChild(card1Back);
            cardHolder.appendChild(card2Front);
            cardHolder.appendChild(card2Back);
            cardHolder.appendChild(cardAnim);
            cardHolder.appendChild(cardAnim2);
            playerSpot.appendChild(cardHolder);
          
            
            //Add stuff here

            
            var playerPot = document.createElement('a-plane');
            playerPot.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/OL.png');
            playerPot.setAttribute('scale', '0.2 0.2 0');
            playerPot.setAttribute('transparent', 'true');
            playerPot.setAttribute('color', '#FFFF00');
            playerPot.setAttribute('position', '0.9 0.3 0');
            playerSpot.appendChild(playerPot);
            
            var playerName1 = document.createElement('a-entity');
            playerName1.setAttribute('n-text', 'fontSize:1; width:4; text:Player'+ (i+1));
            playerName1.setAttribute('position', '0 -1.095 0.03');
            playerName1.setAttribute('rotation', '60 0 0');
            playerSpot.appendChild(playerName1);
            
            var playerName2 = document.createElement('a-entity');
            playerName2.setAttribute('n-text', 'fontSize:1; width:4; text:Player'+ (i+1));
            playerName2.setAttribute('position', '0 -1.045 0.03');
            playerName2.setAttribute('rotation', '-60 0 180');
            playerSpot.appendChild(playerName2);
          
            var potText = document.createElement('a-entity');
            potText.setAttribute('n-text', 'fontSize: 1; width:4; text:$' + (i + 1));
            potText.setAttribute('position', '0.3 -1.095 0.03');
            potText.setAttribute('rotation', '60 0 0');
            potText.setAttribute('fontSize', '0.6');
            playerSpot.appendChild(potText);
          
            var potText2 = document.createElement('a-entity');
            potText2.setAttribute('n-text', 'fontSize: 1; width:4; text:$' + (i + 1));
            potText2.setAttribute('position', '0.3 -1.045 0.03');
            potText2.setAttribute('rotation', '-60 0 180');
            potText2.setAttribute('fontSize', '0.6');
            playerSpot.appendChild(potText2);
            
            var nameTag = document.createElement('a-cylinder');
            nameTag.setAttribute('position', '1.07 0 0.021');
            nameTag.setAttribute('rotation', '0 0 0');
            nameTag.setAttribute('radius', '0.05');
            nameTag.setAttribute('height', '0.4');
            nameTag.setAttribute('color', '#300');
            nameTag.setAttribute('segments-radial', '3');
            playerSpot.appendChild(nameTag);
            
            var potTag = document.createElement('a-cylinder');
            potTag.setAttribute('position', '1.07 0.3 0.021');
            potTag.setAttribute('rotation', '0 0 0');
            potTag.setAttribute('radius', '0.05');
            potTag.setAttribute('height', '0.2');
            potTag.setAttribute('color', '#200');
            potTag.setAttribute('segments-radial', '3');
            playerSpot.appendChild(potTag);
            
            playerSpot.setAttribute('id', 'player' + i + 1);
            playerSpot.setAttribute('position', '');
            playerSpot.setAttribute('rotation', '0 0 ' + i * -45);
            document.querySelector('#tableSurface').appendChild(playerSpot);
        }
        var buttonHolder = document.createElement('a-entity');
        buttonHolder.setAttribute('position', '0 -1 0.05');
        buttonHolder.setAttribute('rotation', '30 0 0');
        
        var foldButton = document.createElement('a-plane');
        foldButton.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/Fold.png');
        foldButton.setAttribute('scale', '0.1 0.07 0');
        foldButton.setAttribute('transparent', 'false');
        //foldButton.setAttribute('color', '#FFFF00');
        foldButton.setAttribute('position', '-0.1 0 0');
        buttonHolder.appendChild(foldButton);
            
        var checkButton = document.createElement('a-plane');
        checkButton.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/Check.png');
        checkButton.setAttribute('scale', '0.1 0.07 0');
        checkButton.setAttribute('transparent', 'false');
        //checkButton.setAttribute('color', '#FFFF00');
        checkButton.setAttribute('position', '0 0 0');
        buttonHolder.appendChild(checkButton);
            
        var raiseButton = document.createElement('a-plane');
        raiseButton.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/Raise.png');
        raiseButton.setAttribute('scale', '0.1 0.07 0');
        raiseButton.setAttribute('transparent', 'false');
        //raiseButton.setAttribute('color', '#FFFF00');
        raiseButton.setAttribute('position', '0.1 0 0');
        buttonHolder.appendChild(raiseButton);
      
        var buttonAnim = document.createElement('a-animation');
        buttonAnim.setAttribute('to', '0 0 -45');
        buttonAnim.setAttribute('direction', 'alternate');
        buttonAnim.setAttribute('repeat', 'indefinite');
      buttonAnim.setAttribute('delay', '2000');
      var buttonHolder2 = document.createElement('a-entity');
        buttonHolder2.setAttribute('position', '0  0.05');
      buttonHolder2.appendChild(buttonHolder);  
      buttonHolder2.appendChild(buttonAnim);
        document.querySelector('#tableSurface').appendChild(buttonHolder2);
      
    }
    function cardClick(el) {
        if (selectedCards.indexOf(el.id) < 0  && selectedCards.length < 7) {
            selectedCards.push(el.id);
            el.setAttribute('color', '#555555');
            document.querySelector('#sel' + selectedCards.length).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + el.id + '.png');
        }
        syncedCards.set(selectedCards);
        if (selectedCards.length == 7) {
            //checkHand();
            findHands();
        }
    }
    function selCardClick(el) {
        if (el.id == 'sel1' && selectedCards.length > 0) {
            removeCard(1);
        } else if (el.id == 'sel2' && selectedCards.length > 1) {
            removeCard(2);
        } else if (el.id == 'sel3' && selectedCards.length > 2) {
            removeCard(3);
        } else if (el.id == 'sel4' && selectedCards.length > 3) {
            removeCard(4);
        } else if (el.id == 'sel5' && selectedCards.length > 4) {
            removeCard(5);
        } else if (el.id == 'sel6' && selectedCards.length > 5) {
            removeCard(6);
        } else if (el.id == 'sel7' && selectedCards.length > 6) {
            removeCard(7);
        }
        document.querySelector('#text').setAttribute('n-text', {fontSize:3, text:''});
        syncedCards.set(selectedCards);
    }
    function removeCard(i) {
        document.querySelector('#' + selectedCards[i-1]).setAttribute('color', '#FFFFFF');
        selectedCards.splice(i-1, 1);
        updateSelCards();
    }
    function updateSelCards() {
        selectedCards.forEach(updateSelCards2);
        if (selectedCards.length < 7) {
            var cardsToClear = 7 - selectedCards.length;
            for (var i = 0; i < cardsToClear; i++) {
                document.querySelector('#sel' + (7 - i)).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/blank.png');
            }
        }
    }
    function updateSelCards2(value, index) {
        document.querySelector('#sel' + (index + 1)).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + value + '.png');
        document.querySelector('#sel' + (index + 1)).setAttribute('color', '#FFFFFF');
    }
    function randomise() {
        selectedCards = [];
        var shuffledCards = cards;
        shuffleArray(shuffledCards);
        for (var i = 0; i < 7; i++) {
            selectedCards.push(shuffledCards[i]);
        }
        updateSelCards();
        syncedCards.set(selectedCards);
    }
    function clear() {
    selectedCards = [];
    updateSelCards();
    syncedCards.set(selectedCards);
    //    for (var i = 0; i < 7; i++) {
    //        selCardClick(document.querySelector('#sel1'))
    //    }
    }
    function shuffleArray(array) {
        for (var i = array.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var temp = array[i];
            array[i] = array[j];
            array[j] = temp;
        }
        return array;
    }
    function findHands() {
        allHands = new Array;
    for (var i = 0; i < 21; i++) {
      var cards1 = JSON.parse(JSON.stringify(selectedCards))
      console.log(cards1);
      console.log(selectedCards);
      
      if (i == 0) {
          cards1.splice(0, 2);
      } else if (i == 1) {
          cards1.splice(2, 1);
          cards1.splice(0, 1);
      } else if (i == 2) {
          cards1.splice(3, 1);
          cards1.splice(0, 1);
      } else if (i == 3) {
          cards1.splice(4, 1);
          cards1.splice(0, 1);
      } else if (i == 4) {
          cards1.splice(1, 2);
      } else if (i == 5) {
          cards1.splice(3, 1);
          cards1.splice(1, 1);
      } else if (i == 6) {
          cards1.splice(4, 1);
          cards1.splice(1, 1);
      } else if (i == 7) {
          cards1.splice(2, 2);
      } else if (i == 8) {
          cards1.splice(4, 1);
          cards1.splice(2, 1);
      } else if (i == 9) {
          cards1.splice(3, 2);
      } else if (i == 10) {
          cards1.splice(5, 1);
          cards1.splice(0, 1);
      } else if (i == 11) {
          cards1.splice(5, 1);
          cards1.splice(1, 1);
      } else if (i == 12) {
          cards1.splice(5, 1);
          cards1.splice(2, 1);
      } else if (i == 13) {
          cards1.splice(5, 1);
          cards1.splice(3, 1);
      } else if (i == 14) {
          cards1.splice(5, 1);
          cards1.splice(4, 1);
      } else if (i == 15) {
          cards1.splice(6, 1);
          cards1.splice(0, 1);
      } else if (i == 16) {
          cards1.splice(6, 1);
          cards1.splice(1, 1);
      } else if (i == 17) {
          cards1.splice(6, 1);
          cards1.splice(2, 1);
      } else if (i == 18) {
          cards1.splice(6, 1);
          cards1.splice(3, 1);
      } else if (i == 19) {
          cards1.splice(6, 1);
          cards1.splice(4, 1);
      } else if (i == 20) {
          cards1.splice(5, 2);
      }
      console.log(i + ': ' + cards1);
      checkHand(cards1);
    }
    function compare(a,b) {
        if (a.score > b.score)
        return -1;
    if (a.score < b.score)
        return 1;
        return 0;
    }
    allHands.sort(compare);
    console.log(allHands);
    console.log(allHands[0]);
    document.querySelector('#text').setAttribute('n-text', {fontSize:3, text:allHands[0].hand + ": " + allHands[0].score})
    
    //Fade unused cards
    var bestHand = allHands[0].number;
    if (bestHand == 0 || bestHand == 1 || bestHand == 2 || bestHand == 3 || bestHand == 10 || bestHand == 15) {
        document.querySelector('#sel1').setAttribute('color', '#555555');
    }
    if (bestHand == 0 || bestHand == 4 || bestHand == 5 || bestHand == 6 || bestHand == 11 || bestHand == 16) {
        document.querySelector('#sel2').setAttribute('color', '#555555');
    }
    if (bestHand == 1 || bestHand == 4 || bestHand == 7 || bestHand == 8 || bestHand == 12 || bestHand == 17) {
        document.querySelector('#sel3').setAttribute('color', '#555555');
    }
    if (bestHand == 2 || bestHand == 5 || bestHand == 7 || bestHand == 9 || bestHand == 13 || bestHand == 18) {
        document.querySelector('#sel4').setAttribute('color', '#555555');
    }
    if (bestHand == 3 || bestHand == 6 || bestHand == 8 || bestHand == 9 || bestHand == 14 || bestHand == 19) {
        document.querySelector('#sel5').setAttribute('color', '#555555');
    }
    if (bestHand == 10 || bestHand == 11 || bestHand == 12 || bestHand == 13 || bestHand == 14 || bestHand == 20) {
        document.querySelector('#sel6').setAttribute('color', '#555555');
    }
    if (bestHand == 15 || bestHand == 16 || bestHand == 17 || bestHand == 18 || bestHand == 19 || bestHand == 20) {
        document.querySelector('#sel7').setAttribute('color', '#555555');
    }
    }
    function checkHand(selectedHand) {
        var suits = [];
        var values = [];
        var numOfSuits = 0;
        var isStreak = false;
        var streakVal = 0;
        var match1Num = 0;
        var match1Val = 0;
        var match2Num = 0;
        var match2Val = 0;
        var hand;
        var score;
        
        // Separate suits from values
        for (var i = 0; i < 5; i++) {
            //selectedHand.push(document.getElementById("card" + (i+1)).value);
            suits.push(selectedHand[i].slice(0, 1));
            values.push(Number(selectedHand[i].slice(1, selectedHand[i].length)));
        }

        // Count suits
        if (suits.indexOf("C") >= 0) {numOfSuits++;}
        if (suits.indexOf("D") >= 0) {numOfSuits++;}
        if (suits.indexOf("H") >= 0) {numOfSuits++;}
        if (suits.indexOf("S") >= 0) {numOfSuits++;}
        values.sort(function(a, b){return a-b});

        // Check for ace to five streak
        if (JSON.stringify(values) == JSON.stringify([2,3,4,5,14])) {values = [1,2,3,4,5];}

        // Check for streak
        if (values[0] == values[1] - 1 && values[1] == values[2] - 1 && values[2] == values[3] - 1 && values[3] == values[4] - 1) {
            isStreak = true;
            streakVal = values[4];
        }

        // Check for matching values
        for (var i = 1; i < 15; i++) {
            var count = 0;
            for (var j = 0; j < 5; j++) {
                if (values[j] == i) {count++;}
            }
            //alert(count);
            if (count > 1 && match1Num == 0) {
                match1Num = count;
                match1Val = i;
            } else if (count > 1) {
                match2Num = count;
                match2Val = i;
            }
        }

        // Asign hand type
        var kicker = 0;
        if (numOfSuits == 1 && streakVal == 14) {
            hand = "Royal Flush";
            score = 10;
        } else if (numOfSuits == 1 && streakVal > 0) {
            hand = "Straight Flush";
            score = 9 + (values[4] / 100);
        } else if (numOfSuits == 1) {
            hand = "Flush";
            score = 6 + (values[4] / 100);
        } else if (streakVal > 0) {
            hand = "Straight";
            score = 5 + (values[4] / 100);
        } else if (match1Num == 4) {
            hand = "Four of a Kind"
            for (var i = 0; i < 5; i++) {
                if (values[i] != match1Val) {
                    kicker = values[i];
                }
            }
            score = 8 + (match1Val / 100) + (kicker / 10000);
        } else if (match1Num == 2 && match2Num == 3) {
            hand = "Full House";
            score = 7 + (match2Val / 100) + (match1Val / 10000);
        } else if (match1Num == 3 && match2Num == 2) {
            hand = "Full House";
            score = 7 + (match1Val / 100) + (match2Val / 10000);
        } else if (match1Num == 3) {
            hand = "Three of a Kind";
            for (var i = 0; i < 3; i++) {
                if (values[i] == match1Val) {
                    values.splice(i, 3);
                }
                kicker = values[values.length - 1];
            }
            score = 4 + (match1Val / 100) + (kicker / 10000);
        } else if (match1Num == 2 && match2Num == 2) {
            hand = "Two Pair";
            for (var i = 0; i < 5; i++) {
                if (values[i] != match1Val && values[i] != match2Val)
                kicker = values[i];
            }
            if (match1Val > match2Val) {
                score = 3 + (match1Val / 100) + (match2Val / 10000) + (kicker / 1000000);
            } else {
                score = 3 + (match2Val / 100) + (match1Val / 10000) + (kicker / 1000000);
            }
        } else if (match1Num == 2) {
            hand = "One Pair";
          for (var i = 0; i < 4; i++) {
                if (values[i] == match1Val) {
                    values.splice(i, 2);
                }
            }
            kicker = values[values.length - 1];
            
            score = 2 + (match1Val / 100) + (kicker / 10000);
        } else {
            hand = "High Card";
            score = 1 + (values[4] / 100) + (values[3] / 10000);
        }
        
        allHands.push({number: allHands.length, hand: hand, score: score});
    }
    
      }).catch(function (err) {
    console.error(err.toString(), err);
  });
</script>
</body>
</html>