<!DOCTYPE html>
<html>
<head>
<script src="https://aframe.io/releases/0.3.1/aframe.min.js"></script>
<script src="https://cdn.rawgit.com/AltspaceVR/aframe-altspace-component/v1.3.1/dist/aframe-altspace-component.min.js"></script>
<script src="https://sdk.altvr.com/libs/altspace.js/0.28.1/altspace.min.js"></script>
</head>
<body>
    <a-scene altspace="verticalAlign: bottom">
        <a-entity id='row1' position='0 1.1 0'></a-entity>
        <a-entity id='row2' position='0 0.9 0'></a-entity>
        <a-entity id='row3' position='0 1.8 0'></a-entity>

        <a-entity id='text' n-text="fontSize:3; width:4; text:" position="0 2.5 0"></a-entity>
        <a-entity position='0 0 4'>
            <a-camera></a-camera>
        </a-entity>
    </a-scene>
<script>
    var cards = ["C14", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "D14", "D2", "D3", "D4", "D5", "D6", "D7", "D8", "D9", "D10", "D11", "D12", "D13", "H14", "H2", "H3", "H4", "H5", "H6", "H7", "H8", "H9", "H10", "H11", "H12", "H13", "S14", "S2", "S3", "S4", "S5", "S6", "S7", "S8", "S9", "S10", "S11", "S12", "S13"];
    
    var selectedCards = [];
    reset();
    function reset() {
        for (var i = 0; i < 52; i++) {
            var box = document.createElement('a-box');
            box.setAttribute('id', cards[i]);
            box.setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + cards[i] + '.png');
            box.setAttribute('width', '0.12');
            box.setAttribute('height', '0.17');
            box.setAttribute('depth', '0.01');
            box.addEventListener('mousedown', function (event) { cardClick(event.target); });
            if (i < 26) {
                box.setAttribute('position', -1.875+(i*.15) + ' 0 0');
                console.log(i + ': ' + (-1.875+(i*.15)) + ' 0 0');
                document.querySelector('#row1').appendChild(box);
            } else {
                box.setAttribute('position', -1.875+((i-26)*.15) + ' 0 0');
                document.querySelector('#row2').appendChild(box);
            }
        }
        for (var i = 1; i<6; i++) {
            var box = document.createElement('a-box');
            box.setAttribute('id', 'sel' + i);
            box.setAttribute('width', '0.72');
            box.setAttribute('height', '1.02');
            box.setAttribute('depth', '0.01');
            box.setAttribute('position', (i-3)*.8 + ' 0 0');
            document.querySelector('#row3').appendChild(box);
            box.addEventListener('mousedown', function (event) { selCardClick(event.target); });
        }
    }
    function cardClick(el) {
        console.log(el.id + ' clicked');
        if (selectedCards.indexOf(el.id) < 0  && selectedCards.length < 5) {
            selectedCards.push(el.id);
            console.log(selectedCards);
            console.log(selectedCards.length);
            el.setAttribute('color', '#555555');
            document.querySelector('#sel' + selectedCards.length).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + el.id + '.png');
        }
        if (selectedCards.length == 5) {
            checkHand();
        }
    }
    function selCardClick(el) {
        console.log(el.id);
        if (el.id == 'sel1' && selectedCards.length > 0) {
            removeCard(1);
        } else if (el.id == 'sel2' && selectedCards.length > 1) {
            removeCard(2);
        } else if (el.id == 'sel3' && selectedCards.length > 2) {
            removeCard(3);
        } else if (el.id == 'sel4' && selectedCards.length > 3) {
            removeCard(4);
        } else if (el.id == 'sel5' && selectedCards.length > 4) {
            removeCard(5);
        }
        document.querySelector('#text').setAttribute('n-text', {fontSize:3, text:''});
    }
    function removeCard(i) {
        document.querySelector('#' + selectedCards[i-1]).setAttribute('color', '#FFFFFF');
        selectedCards.splice(i-1, 1);
        console.log(selectedCards);
        updateSelCards();
    }
    function updateSelCards() {
        selectedCards.forEach(updateSelCards2);
        if (selectedCards.length < 5) {
            var cardsToClear = 5 - selectedCards.length;
            for (var i = 0; i < cardsToClear; i++) {
                console.log(i);
                document.querySelector('#sel' + (5 - i)).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/blank.png');
            }
        }
    }
    function updateSelCards2(value, index) {
        document.querySelector('#sel' + (index + 1)).setAttribute('src', 'https://bengarfield.github.io/AltVR-Tests/poker/' + value + '.png');
    }
    function checkHand() {
        document.querySelector('#text').setAttribute('n-text', {fontSize:3, text:'Royal Flush'});
    }
</script>
</body>
</html>
